{% extends "layout.html" %}

{% block content %}
<a href="{{ url_for('messages.inbox') }}" class="back-link">‚Üê Back</a>

<div class="mail-read">
    <div class="mail-subject">Message from {{ mail.sender }}</div>

    <div class="mail-meta">
        <span>{{ mail.created_at }}</span>
    </div>

    {% if error %}
    <div class="error-message">
        <i class="fas fa-exclamation-circle"></i> {{ error }}
    </div>
    {% endif %}

    {% if decrypted_message %}
    <div class="verification-status">
        {% if hash_valid %}
        <div class="status-item valid">
            <i class="fas fa-check-circle"></i> Hash verification: Valid
        </div>
        {% else %}
        <div class="status-item invalid">
            <i class="fas fa-times-circle"></i> Hash verification: Invalid
        </div>
        {% endif %}
        
        {% if signature_valid %}
        <div class="status-item valid">
            <i class="fas fa-check-circle"></i> Digital signature: Valid
        </div>
        {% else %}
        <div class="status-item invalid">
            <i class="fas fa-times-circle"></i> Digital signature: Invalid
        </div>
        {% endif %}
    </div>

    <div class="mail-body-content">
        {{ decrypted_message }}
    </div>
    {% else %}
    <form method="POST" class="decrypt-form">
        <p class="decrypt-prompt">Enter your password to decrypt this message:</p>
        <input type="password" 
               name="password" 
               placeholder="Your account password" 
               required 
               autofocus>
        <button type="submit" class="decrypt-btn">Decrypt Message</button>
    </form>
    {% endif %}
</div>
{% endblock %}
